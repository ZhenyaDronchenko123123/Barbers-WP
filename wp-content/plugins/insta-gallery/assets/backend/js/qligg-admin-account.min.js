!function($){"use strict";_.mixin({escapeHtml:function(attribute){return attribute.replace("&amp;",/&/g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#039;/g,"'")},getFormData:function($form){return $form.serializeJSON()}});var Account=Backbone.Model.extend({defaults:{access_token:""}}),AccountView=Backbone.View.extend({events:{"change input":"enable","click .media-modal-close":"close","submit .media-modal-form":"submit"},templates:{},initialize:function(){_.bindAll(this,"open","render","close","enable","submit"),this.init(),this.open()},init:function(){this.templates.window=wp.template("qligg-modal-account-main")},render:function(){var modal=this;this.$el.html(this.templates.window(this.model.attributes))},updateModel:function(e){e.preventDefault();var modal=this,$form=this.$el.find("form"),model=_.getFormData($form);this.model.set(model)},enable:function(e){$(".media-modal-submit").removeProp("disabled"),this.updateModel(e)},open:function(e){this.render(),$("body").addClass("modal-open").append(this.$el)},close:function(e){e.preventDefault(),this.undelegateEvents(),$(document).off("focusin"),$("body").removeClass("modal-open"),this.remove()},submit:function(e){e.preventDefault();var modal=this,$modal=modal.$el.find("#qligg_modal"),$spinner=$modal.find(".settings-save-status .spinner"),$saved=$modal.find(".settings-save-status .saved");return $.ajax({url:ajaxurl,data:{action:"qligg_add_account",nonce:qligg_account.nonce.qligg_add_account,account_data:modal.model.attributes},dataType:"json",type:"POST",beforeSend:function(){$(".media-modal-submit").prop("disabled",!0),$spinner.addClass("is-active")},complete:function(){$spinner.removeClass("is-active")},error:function(response){alert("Error!")},success:function(response){response.success?($modal.addClass("reload"),$saved.addClass("is-active"),_.delay((function(){$saved.removeClass("is-active")}),5e3),modal.close(e),window.location.reload()):alert(response.data)}}),!1}}),AccountModal=Backbone.View.extend({initialize:function(e){var model=new Account;model.set({access_token:""}),new AccountView({model:model})}});$(document).on("click","[data-qligg-copy-token]",(function(e){e.preventDefault(),$($(this).data("qligg-copy-token")).select(),document.execCommand("copy")})),$(document).on("click","[data-qligg-delete-token]",(function(e){var c;if(e.preventDefault(),!confirm(qligg_account.message.confirm_delete))return!1;var $button,account_id=$(e.target).closest("[data-account_id]").data("account_id"),$spinner=$(e.target).closest("td").find(".spinner");$.ajax({url:ajaxurl,type:"post",data:{action:"qligg_delete_account",account_id:account_id,nonce:qligg_account.nonce.qligg_delete_account},beforeSend:function(){$spinner.addClass("is-active")},success:function(response){response.success?setTimeout((function(){window.location.reload()}),300):alert(response.data)},complete:function(){$spinner.removeClass("is-active")},error:function(jqXHR,textStatus){console.log(textStatus)}})})),$("#qligg-add-token").on("click",(function(e){e.preventDefault(),new AccountModal(e)}))}(jQuery);